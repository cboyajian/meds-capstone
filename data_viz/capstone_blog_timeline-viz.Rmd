---
title: "Data viz options"
author: "Clarissa Boyajian"
date: "11/19/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(lubridate)
library(vistime)
```

```{r parameters}
# html color codes
dark_green <- "#196F3D"
dark_yellow <- "#FCB322"
dark_blue <- "#004266"
dark_red <- "#990000"
```



## Create timeline df:
```{r}

```


## Gantt period option:
```{r}
# create df
phase_timeline <- data.frame(
  phase = c("Proposal", 
           "Selection",
           "Capstone Project"),
  start_y = c(rep(c(2021), times = 2), 
              rep(c(2022), times = 1)),
  start_m = c(08, 11, 01),
  start_d = c(01, 01, 01),
  end_y = c(rep(c(2021), times = 2), 
            rep(c(2022), times = 1)),
  end_m = c(10, 12, 06),
  end_d = c(31, 31, 30)
  )

# add color for phases
phase_timeline <- phase_timeline %>% 
  mutate(phase_color = case_when(phase == "Proposal" ~ dark_green,
                                 phase == "Selection" ~ dark_blue,
                                 phase == "Capstone Project" ~ dark_red))

# create start date column
phase_timeline$start_date <- with(phase_timeline, 
                                  ymd(sprintf('%04d%02d%02d', 
                                      phase_timeline$start_y, 
                                      phase_timeline$start_m, 
                                      phase_timeline$start_d)))

# create end date column
phase_timeline$end_date <- with(phase_timeline, 
                                ymd(sprintf('%04d%02d%02d', 
                                      phase_timeline$end_y, 
                                      phase_timeline$end_m, 
                                      phase_timeline$end_d)))

# plot viz
vistime(data = phase_timeline,
           col.event = "phase",
           col.start = "start_date",
           col.end = "end_date",
           col.color = "phase_color",
           optimize_y = TRUE)

## 1 IDEA: we could add each item that occurs within each phase as a list that shows up when you hover over that phase (unsure how to do this)
```


## Point-line-segment events option:
```{r}
# create df
cap_timeline <- data.frame(
  task = c("Capstone Kickoff Workshop", 
           "Writing A Proposal Workshop", 
           "Write Proposals", 
           "Projects Revealed to MEDS", 
           "Student Voting", 
           "Final Capstone Assignments",
           "Design & Implementation Plan",
           "Design Plan Presentations",
           "Technical Documentation & Repo",
           "Final Presentations"),
  event_type = c("Selection (required)",
                 "Proposal (optional)",
                 "Proposal (optional)",
                 "Announcements",
                 "Selection (required)",
                 "Announcements", 
                 "Capstone Project",
                 "Capstone Project",
                 "Capstone Project",
                 "Capstone Project"),
  start_y = c(rep(c(2021), times = 6), 
              rep(c(2022), times = 4)),
  start_m = c(08, 08, 08, 11, 11, 12, 01, 03, 03, 05),
  start_d = c(09, 26, 27, 17, 19, 01, 02, 03, 04, 26),
  end_y = c(rep(c(2021), times = 6), 
            rep(c(2022), times = 4)),
  end_m = c(08, 08, 10, 11, 11, 12, 02, 03, 04, 05),
  end_d = c(10, 27, 15, 18, 24, 02, 11, 04, 29, 27)
  )

# add color for event type
cap_timeline <- cap_timeline %>% 
  mutate(event_type_color = case_when(event_type == "Proposal (optional)" ~ dark_green,
                                      event_type == "Announcements" ~ dark_yellow,
                                      event_type == "Selection (required)" ~ dark_blue,
                                      event_type == "Capstone Project" ~ dark_red))

# re-level event type factor
event_type_levels <- c("Announcements", "Proposal (optional)", "Selection (required)", "Capstone Project")
cap_timeline$event_type <- factor(cap_timeline$event_type, 
                                  levels = event_type_levels, 
                                  ordered = TRUE)
event_type_color <- (c("goldenrod", "darkred"))

# create start date column
cap_timeline$start_date <- with(cap_timeline, 
                          ymd(sprintf('%04d%02d%02d', 
                                      cap_timeline$start_y, 
                                      cap_timeline$start_m, 
                                      cap_timeline$start_d)))

# create end date column
cap_timeline$end_date <- with(cap_timeline, 
                          ymd(sprintf('%04d%02d%02d', 
                                      cap_timeline$end_y, 
                                      cap_timeline$end_m, 
                                      cap_timeline$end_d)))

# add numerical order row
cap_timeline$order <- 1:nrow(cap_timeline)

# order all rows by date
cap_timeline <- cap_timeline[with(cap_timeline, order(start_date)), ]

```

```{r}
month_buffer <- 2

month_date_range <- seq(min(cap_timeline$start_date) - months(month_buffer), 
                        max(cap_timeline$start_date) + months(month_buffer), 
                        by = "month")

month_format <- format(month_date_range, "%b")

month_df <- data.frame(month_date_range, month_format)

year_date_range <- seq(min(cap_timeline$start_date) - months(month_buffer), 
                       max(cap_timeline$start_date) + months(month_buffer), 
                       by = "year")

year_format <- format(year_date_range, "%Y")

year_df <- data.frame(year_date_range, year_format)

```

```{r}
positions <- c(-0.5, -1.0, 0.25, 0.4, -0.25, 
               0.75, 1.0, 0.5, -1.0, -0.5)

directions <- c(-1, -1, 1, 1, -1, 
                1, 1, 1, -1, -1)

line_pos <- data.frame(
  "start_date" = unique(cap_timeline$start_date),
  "position" = rep(positions, length.out = length(unique(cap_timeline$start_date))),
  "direction" = rep(directions, length.out = length(unique(cap_timeline$start_date)))
)

cap_timeline <- left_join(x = cap_timeline, y = line_pos, by = "start_date")
```

```{r}
text_offset <- 0.15

absolute_value <- (abs(cap_timeline$position))

text_position <- absolute_value + text_offset

cap_timeline$text_position <- text_position * cap_timeline$direction
```

```{r}
timeline_plot <- ggplot(data = cap_timeline, 
                        aes(x = start_date, y = position, col = event_type, label = task)) +
  labs(col = "Tasks") +
  scale_color_manual(values = event_type_color, 
                     labels = event_type_levels, 
                     drop = FALSE) +
  theme_classic() +
  geom_hline(yintercept = 0, 
             color = "black", 
             size = 0.3) +
  geom_segment(aes(y = position,
                   yend = 0,
                   xend = start_date), 
               color = "black", 
               size = 0.2) +
  geom_point(aes(y = position), 
             size = 3) +
  theme(axis.line.y = element_blank(),
        axis.text.y = element_blank(),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.ticks.y = element_blank(),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        axis.line.x = element_blank(),
        legend.position = "bottom") +
  geom_text(data = month_df, 
            aes(x = month_date_range,
                y = -0.15,
                label = month_format), 
            size = 3.5, 
            vjust = 0.5, 
            color = "black", 
            angle = 90) +
  geom_text(data = year_df,
            aes(x = year_date_range,
                y = -0.5,
                label = year_format,
                fontface = "bold"), 
            size = 3.5, 
            color = "black") +
  geom_text(aes(y = text_position, 
                label = task), 
            size = 3.5, 
            vjust = 0.6)

timeline_plot
```










